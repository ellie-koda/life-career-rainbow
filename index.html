<!DOCTYPE html>
<html lang="ja">
<head>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <meta charset="UTF-8" />
  <title>ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ï¼ˆé‡è¦åº¦ã®å‰²åˆãƒ»Webç‰ˆï¼‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
.description-list {
  margin: 1rem 0;
  padding-left: 1.2rem;
  list-style: none;
}

.description-list li {
  position: relative;
  margin-bottom: 0.45rem;
  padding-left: 1.1rem;
  line-height: 1.7;
}

/* ãƒãƒ¼ã‚«ãƒ¼ã‚’ä¸¸ã«ã™ã‚‹ */
.description-list li::before {
  content: "â—";
  position: absolute;
  left: 0;
  top: 0.2em;
  color: #3949ab;
  font-size: 0.7rem;
  font-weight: bold;
}
/* â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
   åˆ—ãƒã‚¤ãƒ©ã‚¤ãƒˆï¼ˆåˆè¨ˆ100ï¼…/ã‚ªãƒ¼ãƒãƒ¼ï¼‰
   â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” */

/* åˆè¨ˆãŒã¡ã‚‡ã†ã©100ï¼…ã®åˆ—ï¼šã†ã£ã™ã‚‰ã‚°ãƒªãƒ¼ãƒ³ */
.col-perfect {
  background-color: #e6f7ec !important;  /* è–„ã„ã‚°ãƒªãƒ¼ãƒ³ */
}

/* åˆè¨ˆãŒ100ï¼…ã‚’è¶…ãˆãŸåˆ—ï¼šã†ã£ã™ã‚‰èµ¤ç³»ï¼‹ãƒãƒƒãƒãƒ³ã‚° */
.col-over {
  background-color: #ffecec !important;
  background-image: repeating-linear-gradient(
    -45deg,
    rgba(255, 200, 200, 0.45) 0,
    rgba(255, 200, 200, 0.45) 4px,
    rgba(255, 255, 255, 0.2) 4px,
    rgba(255, 255, 255, 0.2) 8px
  ) !important;
}

/* å…¥åŠ›æ¬„ã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆã®ä¸Šã§ã‚‚ç™½ã‚’ç¶­æŒã—ã¦è¦–èªæ€§ã‚’ç¢ºä¿ */
.col-perfect input[type="number"],
.col-perfect textarea,
.col-over input[type="number"],
.col-over textarea {
  background-color: #ffffff !important;
  position: relative;
  z-index: 1;   /* èƒŒæ™¯ãƒãƒƒãƒãƒ³ã‚°ã®ä¸Šã«æç”»ã•ã‚Œã‚‹ã‚ˆã†ã« */
}
/* ã‚¹ãƒãƒ›ã§ã¯ã•ã‚‰ã«èª­ã¿ã‚„ã™ã */
@media (max-width: 768px) {
  .description-list li {
    line-height: 1.9;
    padding-left: 1.3rem;
  }

 /* â–¼ ç¾åœ¨ãƒ˜ãƒƒãƒ€ãƒ¼ã®å¹´é½¢å…¥åŠ›ã ã‘ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã™ã‚‹ â–¼ */
  #main-table thead th .age-input {
    font-size: 13px;        /* ãƒ©ãƒ™ãƒ«ã®ã‚µã‚¤ã‚ºï¼ˆPCã¨ã»ã¼åŒã˜ï¼‰ */
    margin-top: 4px;
    white-space: nowrap;    /* ã€Œå¹´é½¢ï¼šâ—¯â—¯æ­³é ƒã€ã‚’1è¡Œã«å›ºå®š */
  }

  #main-table thead th .age-input input[type="number"] {
    width: 2.4em !important;  /* â˜… 2æ¡ï¼‹Î±ã‚®ãƒªã‚®ãƒª */
    font-size: 13px !important;
    padding: 1px 2px;
  }
/* â–¼ ã‚¹ãƒãƒ›æ™‚ã®èª¬æ˜æ›¸ãã‚’ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã«ã™ã‚‹ â–¼ */
@media (max-width: 768px) {

  /* ç®‡æ¡æ›¸ã1è¡Œã®æ–‡å­—ã‚µã‚¤ã‚ºã‚’å°ã•ã */
  .description-list li {
    font-size: 0.78rem;    /* â† ã¡ã‚‡ã†ã©èª­ã¿ã‚„ã™ã„é™ç•Œãƒ©ã‚¤ãƒ³ */
    line-height: 1.45;     /* â† é–“å»¶ã³æ„Ÿã‚’ãªãã™ */
    margin-bottom: 0.35rem;
    padding-left: 1.1rem;  /* ãƒãƒ¼ã‚«ãƒ¼ã®ä½ç½®ã‚’ä¿ã£ãŸã¾ã¾ä½™ç™½ã‚’å‰Šã‚‹ */
  }

  /* ç®‡æ¡æ›¸ãã®ãƒãƒ¼ã‚«ãƒ¼ã‚‚å°‘ã—å°ã•ã */
  .description-list li::before {
    font-size: 0.6rem;
    top: 0.25em;
  }

  /* èª¬æ˜æ–‡å…¨ä½“ï¼ˆulï¼‰è‡ªä½“ã®ä¸Šä¸‹ä½™ç™½ã‚’å°‘ã—æ¸›ã‚‰ã™ */
  .description-list {
    margin: 0.6rem 0 0.8rem 0;
  }

  /* ç« ã‚¿ã‚¤ãƒˆãƒ«ã‚‚å°‘ã—åœ§ç¸® */
  h2 {
    margin-top: 0.3rem;
    margin-bottom: 0.4rem;
    font-size: 1.1rem;
  }
}
}
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      margin: 1.5rem;
      line-height: 1.6;
      background: #f3f5ff;
      color: #333;
    }
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background: #fff;
      padding: 1.5rem;
      border-radius: 10px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.08);
      border-top: 6px solid #5c6bc0;
    }
    h1, h2 {
      text-align: center;
      color: #3949ab;
      margin: 0.5rem 0;
    }
h1 {
  word-break: keep-all;   /* ä¸è‡ªç„¶ãªä½ç½®ï¼ˆãƒ¯ãƒ¼ï½œã‚¯ï¼‰ã§æŠ˜ã‚Šè¿”ã•ãªã„ */
}
    .note {
      font-size: 0.85rem;
      color: #666;
    }
/* ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å†…ã®èª¬æ˜æ–‡ã ã‘å°‘ã—å¤§ãã */
#rainbow-overlay .note {
  font-size: 0.95rem;  /* 0.85 â†’ 0.95 ç›¸å½“ã€‚ã‚‚ã£ã¨å¤§ããã—ãŸã‘ã‚Œã° 1.0rem ã§ã‚‚OK */
}
  .table-wrapper {
  width: 100%;
  overflow-x: auto;               /* æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’è¨±å¯ */
  -webkit-overflow-scrolling: touch; /* iOSã§ã®æ…£æ€§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
}
/* ============================================
   æ™‚é–“è»¸ãƒ˜ãƒƒãƒ€ãƒ¼ï¼ˆ20å¹´å‰ã€œç†æƒ³ï¼‰ãƒãƒ©ãƒ³ã‚¹èª¿æ•´ç‰ˆ
   ============================================ */
#main-table thead th {
  padding: 10px 6px;      /* 8 â†’ 10 ã«å°‘ã—åºƒã’ã‚‹ */
  font-size: 15px;
  font-weight: 600;
  text-align: center;
  vertical-align: middle;
  line-height: 1.3;
}

/* ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã®ï¼ˆâ—¯æ­³é ƒï¼‰ã®è¦‹ãŸç›®ã‚’æœ€å„ªå…ˆã§çµ±ä¸€ */
#main-table thead th .note {
  display: block;
  margin: 4px 0 0 0 !important;
  padding-left: 0 !important;
  line-height: 1.3;
  font-size: 13px;
  color: #555;
}
/* ãƒ˜ãƒƒãƒ€ãƒ¼ã®ã€Œå¹´é½¢ï¼šâ—¯æ­³é ƒã€ã¯ã“ã®æŒ‡å®šã‚’æœ€å„ªå…ˆã§ä½¿ã† */
#main-table thead th .age-input {
  margin-top: 4px !important;
  font-size: 14px !important;
}

#main-table thead th .age-input input {
  font-size: 14px !important;
  padding: 2px 4px;
}
/* ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ãƒ«å†…ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç”¨ãƒ©ãƒƒãƒ‘ãƒ¼ */
.th-box {
  display: flex;
  flex-direction: column;
  justify-content: center;  /* å‚ç›´æ–¹å‘ã®ä¸­å¤®å¯„ã› */
  align-items: center;      /* æ°´å¹³æ–¹å‘ã®ä¸­å¤®å¯„ã› */
  height: 100%;             /* th ã®é«˜ã•ã«ãƒ•ã‚£ãƒƒãƒˆ */
}

/* è£œè¶³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆâ—¯æ­³é ƒï¼‰ */
#main-table thead th .note {
  display: block;
  margin-top: 4px;         /* é©åº¦ãªä¸‹ã’ */
  font-size: 13px;
  color: #555;
}

/* ç¾åœ¨ã®å¹´é½¢å…¥åŠ›æ¬„ */
#main-table thead th .age-input {
  margin-top: 6px;         /* å¹´é½¢å…¥åŠ›æ¬„ã‚’ã‚„ã‚„ä¸‹ã’ã‚‹ â†’ è‡ªç„¶ãªä¸­å¤®ä½ç½®ã«ï¼ */
  font-size: 13px;
}

/* å·¦ç«¯ã®ã€Œãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«ã€ã ã‘èƒŒæ™¯ã‚’å¤‰ãˆã‚‹ */
#main-table thead th:first-child {
  background-color: #fafafa;
}



/* ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«ï¼ˆå½¹å‰²ï¼‰åˆ—ã®è¦‹ãŸç›® */
#main-table thead th:first-child {
  /* å·¦ç«¯ã®ã€Œãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«ï¼ˆå½¹å‰²ï¼‰ã€ã‚»ãƒ« */
  align-items: center;   /* ä¸­å¤®å¯„ã› */
  background-color: #fafafa;
}
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 1rem 0;
      font-size: 0.9rem;
      table-layout: fixed;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 0.35rem;
      text-align: center;
      vertical-align: middle;
      word-wrap: break-word;
    }
    th {
      background: #e8eaf6;
    }
    /* æ™‚é–“è»¸åˆ—ã‚«ãƒ©ãƒ¼ */
    thead th:nth-child(2),
    thead th:nth-child(3),
    thead th:nth-child(4),
    thead th:nth-child(5),
    thead th:nth-child(6) {
      background: #e3f2fd;
    }
    tbody td:nth-child(2),
    tbody td:nth-child(3),
    tbody td:nth-child(4),
    tbody td:nth-child(5),
    tbody td:nth-child(6),
    tfoot td:nth-child(2),
    tfoot td:nth-child(3),
    tfoot td:nth-child(4),
    tfoot td:nth-child(5),
    tfoot td:nth-child(6) {
      background: #fafbff;
    }
    /* ç†æƒ³åˆ—å¼·èª¿ */
    thead th:nth-child(7) {
      background: #fce4ec;
      border-left: 3px solid #f06292;
    }
    tbody td:nth-child(7),
    tfoot td:nth-child(7) {
      background: #fff7fb;
      border-left: 3px solid #f06292;
    }
    /* å·¦ç«¯ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ« */
    tbody th {
      background: #ede7f6;
      white-space: nowrap;
    }
/* ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åï¼‹èª¬æ˜ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆèª¿æ•´ç‰ˆï¼‰ */
/* ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åï¼‹èª¬æ˜ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆèª¿æ•´ç‰ˆï¼‰ */
.role-cell {
  display: flex;
  flex-direction: column;
  align-items: center;     /* ãƒ©ãƒ™ãƒ«ã‚’ä¸­å¤®å¯„ã› */
  justify-content: center;
  width: 100%;
  text-align: center;
  box-sizing: border-box;
}

.role-name {
  font-weight: 700;        /* ãƒ©ãƒ™ãƒ«ã¯ã—ã£ã‹ã‚Šå¤ªå­—ã§ç›®ç«‹ãŸã›ã‚‹ */
  font-size: 0.95rem;
  margin-bottom: 0.15rem;
}

.role-desc {
  font-size: 0.7rem;
  line-height: 1.4;
  color: #666;
  margin: 0;
  width: 100%;
  max-width: 100%;
  white-space: normal;
  overflow-wrap: break-word;
  opacity: 0.9;
  font-weight: normal;     /* â˜… ã“ã“ã‚’æ˜ç¤ºã—ã¦ç´°å­—ã«ã™ã‚‹ */
}

/* å°åˆ·ç”¨ï¼ˆç”»åƒåŒ–ç”¨ï¼‰ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã¯èª¬æ˜æ–‡ã‚’éš ã™ï¼ˆãã®ã¾ã¾ã§OKï¼‰ */
#print-container .role-desc {
  display: none !important;
}

/* ã‚¹ãƒãƒ›æ™‚ */
@media (max-width: 768px) {
  .role-name {
    font-size: 0.9rem;
  }
  .role-desc {
    font-size: 0.64rem;
    line-height: 1.4;
    width: 100%;
    max-width: 100%;
    font-weight: normal;   /* å¿µã®ãŸã‚ãƒ¢ãƒã‚¤ãƒ«å´ã«ã‚‚æŒ‡å®š */
  }
}


    /* ã“ã“ã‚’æ›¸ãæ›ãˆ */
input[type="number"] {
  width: 2.4em; /* â˜… 2æ¡ï¼‹Î±ãŒå…¥ã‚‹ã‚®ãƒªã‚®ãƒªãã‚‰ã„ */
  padding: 0.15rem;
  text-align: right;
  font-weight: bold;
}

/* ã‚¹ãƒãƒ›ã®ã¨ãã¯ã•ã‚‰ã«å°‘ã—ã ã‘ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
@media (max-width: 768px) {
  input[type="number"] {
    width: 2.2em; /* â˜… 2æ¡ç”¨ã®æœ€å°ã‚µã‚¤ã‚º */
  }
}
    .sum-row {
      background: #fffde7;
      font-weight: bold;
    }
    .sum-ok {
      color: #0c8a3b;
      font-weight: bold;
    }
    .sum-warn {
      color: #c62828;
      font-weight: bold;
    }
    .age-input {
      font-size: 0.8rem;
      margin-top: 0.2rem;
    }
    .age-input input[type="number"] {
      width: 4em;
      font-size: 0.8rem;
      font-weight: normal;
    }
    .cell-content {
      display: flex;
      flex-direction: row;
      align-items: stretch;
      justify-content: space-between;
      gap: 0.25rem;
    }
    .percent-block {
      display: flex;
      align-items: center;
      gap: 0.1rem;
      white-space: nowrap;
    }
    .percent-label {
      font-size: 0.8rem;
      font-weight: bold;
    }
    .memo-input {
  flex: 1;
  font-size: 0.75rem;
  padding: 0.15rem 0.25rem;
  box-sizing: border-box;
  border: 1px solid #e0e0e0;
  border-radius: 3px;
  
  /* â˜… ã“ã“ã‹ã‚‰ãŒè¿½åŠ ãƒ»å¤‰æ›´ãƒã‚¤ãƒ³ãƒˆ */
  height: 3.6em;          /* 3è¡Œåˆ† */
  max-height: 3.6em;      /* ã“ã‚Œä»¥ä¸Šä¼¸ã³ãªã„ */
  overflow-y: auto;        /* 4è¡Œä»¥ä¸Šã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ« */
  resize: none;            /* æ‰‹å‹•ã§ã‚µã‚¤ã‚ºå¤‰æ›´ã§ããªã„ã‚ˆã†ã« */
}

@media (max-width: 768px) {
  .memo-input {
    height: 3.2em;
    max-height: 3.2em;
  }
}
    .memo-input::placeholder {
      color: #d0d0d0;
    }
    .memo-active {
      background-color: #ffffff;
      border-color: #9e9e9e;
      color: #333333;
    }
    .buttons {
      margin-top: 1rem;
      display: flex;
      gap: 0.5rem;
      justify-content: flex-end;
      flex-wrap: wrap;
    }
    /* ãƒ™ãƒ¼ã‚¹ï¼šä¸¸ãã¦å„ªã—ã„ãƒœã‚¿ãƒ³ */
.btn {
  padding: 0.6rem 1.2rem;
  border-radius: 999px;
  border: none;
  font-size: 0.92rem;
  font-weight: 600;
  cursor: pointer;
  display: inline-flex;
  align-items: center;
  gap: 0.4rem;
  transition: all 0.2s ease;
  user-select: none;
}

/* ç”»åƒåŒ–ãƒœã‚¿ãƒ³ï¼šç©ºè‰²ç³»ã®ã‚°ãƒ©ãƒ‡ */
.btn-image {
  background: linear-gradient(135deg, #6ec6ff, #42a5f5);
  color: #fff;
  box-shadow: 0 4px 8px rgba(66,165,245,0.28);
}
.btn-image:hover {
  background: linear-gradient(135deg, #81d4fa, #64b5f6);
  transform: translateY(-2px);
}

/* ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ãƒœã‚¿ãƒ³ï¼šç´«ã®ã‚°ãƒ©ãƒ‡ */
.btn-rainbow {
  background: linear-gradient(135deg, #ba68c8, #8e24aa);
  color: #fff;
  box-shadow: 0 4px 8px rgba(142,36,170,0.28);
}

.btn-rainbow:hover {
  background: linear-gradient(135deg, #ce93d8, #9c27b0);
  transform: translateY(-2px);
}

/* ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã¯è½ã¡ç€ã„ãŸæ„Ÿã˜ã§ */
.btn-reset {
  background: #f5f5f5;
  border: 1px solid #ddd;
  color: #555;
}
.btn-reset:hover {
  background: #eeeeee;
  transform: translateY(-2px);
}

    /* ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
    .overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.4);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }
    .hidden {
      display: none;
    }
   .overlay-content {
  background: #ffffff;
  max-width: 960px;
  width: 95%;
  max-height: 95vh; /* â˜… 85 â†’ 95 ã«ã—ã¦ç”»é¢ã„ã£ã±ã„è¿‘ãã¾ã§ */
  display: flex;
  flex-direction: column;
  padding: 1rem 1.2rem 1.2rem;
  border-radius: 8px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
  box-sizing: border-box;
  overflow: auto;
  position: relative;           /* ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ—ã®åŸºæº–ã«ã™ã‚‹ãŸã‚è¿½åŠ  */
}

.overlay-header {
  display: flex;
  align-items: center;
  justify-content: center;      /* ã‚¿ã‚¤ãƒˆãƒ«ã‚’ä¸­å¤®å¯„ã› */
  gap: 0.5rem;
  margin-bottom: 0.4rem;
  position: relative;           /* Ã—ãƒœã‚¿ãƒ³ã‚’å³ä¸Šã«çµ¶å¯¾é…ç½®ã™ã‚‹ãŸã‚ */
}

.overlay-header h2 {
  margin: 0;
  text-align: center;
}

.btn-close {
  background: #eeeeee;
  color: #424242;
  font-size: 1rem;
  padding: 0.1rem 0.6rem;
  position: absolute;           /* å³ä¸Šã«å›ºå®š */
  right: 0.2rem;
  top: 0.2rem;
}
    .btn-close:hover {
      background: #e0e0e0;
    }
    #rainbow-chart {
      margin-top: 0.8rem;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }
/* â˜… ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¯ã€Œå³å¯„ã›ãƒ»é€šå¸¸ãƒ•ãƒ­ãƒ¼ã€ */
#image-overlay .overlay-header {
  width: 100%;
  display: flex;
  justify-content: flex-end;  /* å³å¯„ã› */
  align-items: center;
  margin-bottom: 0.4rem;
  position: static;           /* ç‰¹åˆ¥ãª absolute åŸºæº–ã«ã—ãªã„ */
}

/* ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã§ã¯ã€âœ•ãƒœã‚¿ãƒ³ã¯æ™®é€šã®ãƒ•ãƒ­ãƒ¼ã§å³ç«¯ã«å‡ºã™ */
#image-overlay .btn-close {
  position: static;           /* ã‚°ãƒ­ãƒ¼ãƒãƒ«ã® absolute ã‚’æ‰“ã¡æ¶ˆã™ */
  margin-left: auto;
}

/* ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼šç”»é¢å¹…ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã‚‹ */
#rainbow-canvas {
  flex: 1;                /* â˜… æ®‹ã‚Šé«˜ã•ã«è‡ªå‹•ãƒ•ã‚£ãƒƒãƒˆ */
  width: 100%;
  height: auto;
  touch-action: pan-x pan-y;  /* ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ãªã©ã®å¦¨ã’ã«ãªã‚‰ãªã„ã‚ˆã†ã« */
}
    .rainbow-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .rainbow-label {
      width: 5.5em;
      font-size: 0.85rem;
      text-align: right;
      white-space: nowrap;
    }
    .rainbow-bar {
  flex: 1;
  display: flex;
  height: 22px;
  border-radius: 6px;
  overflow: hidden;
  border: 1px solid #ddd;
  background: #f5f5f5;
}

.rainbow-segment {
  flex: 1;                  /* 5ã¤ã®æ™‚é–“è»¸ãƒã‚¹ã‚’ç­‰é–“éš”ã« */
  height: 100%;
  font-size: 0.7rem;
  color: #ffffff;
  text-align: center;
  line-height: 22px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: clip;
  box-sizing: border-box;
  border-right: 1px solid #eee;
}

/* ä¸€ç•ªå³ã®ãƒã‚¹ã ã‘ã€å³ã®å¢ƒç•Œç·šã‚’æ¶ˆã—ã¦ãŠãã¨è¦‹ãŸç›®ãŒç¶ºéº— */
.rainbow-segment:last-child {
  border-right: none;
}

/* æ¨ªè»¸ã®å¹´é½¢ãƒ©ãƒ™ãƒ«ç”¨ï¼ˆèƒŒæ™¯ã‚’ç™½ã£ã½ãã—ã¦æ–‡å­—ã ã‘è¦‹ã›ã‚‹ï¼‰ */
.rainbow-axis-segment {
  background: #fafafa !important;
  color: #555 !important;
  font-weight: bold;
}
    .rainbow-legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem 0.8rem;
      margin-top: 0.8rem;
      font-size: 0.8rem;
    }
    .rainbow-legend-item {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    .rainbow-color-box {
      width: 14px;
      height: 14px;
      border-radius: 3px;
      border: 1px solid rgba(0, 0, 0, 0.1);
    }
    @media (max-width: 768px) {
  body {
    margin: 0.5rem;
  }

/* â˜… ã‚¹ãƒãƒ›ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã‚’å°‘ã—å°ã•ã‚ã«ã—ã¦1è¡Œã«åã¾ã‚Šã‚„ã™ãã™ã‚‹ */
  h1 {
    font-size: 1.4rem;   /* é€šå¸¸ã‚ˆã‚Šå°‘ã—å°ã•ã‚ */
    line-height: 1.3;
  }

  #rainbow-canvas {
    max-height: 90vh;
  }
  .container {
    padding: 0.6rem;
  }

  #main-table {
    min-width: 900px;
    font-size: 0.8rem;
  }

  #main-table th,
  #main-table td {
    padding: 0.25rem;
  }

  .cell-content {
    display: grid;
    grid-template-columns: auto minmax(5em, 1fr);
    align-items: stretch;
    column-gap: 0.25rem;
  }

  .percent-block {
    justify-content: flex-start;
  }

  input[type="number"] {
    width: 2.2em;
  }

  .memo-input {
    width: 100%;
    min-height: 2.2em;
    font-size: 0.7rem;
  }

  #main-table th:first-child,
  #main-table td:first-child {
    position: sticky;
    left: 0;
    z-index: 3;
    background: #ede7f6;
  }

  /* â˜… ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯ã€Œå°‘ã—å°ã•ã‚ã€ã«ã—ã¦èƒŒé¢ã®æš—ã„éƒ¨åˆ†ã‚’è¦‹ã›ã‚‹ */
  #rainbow-overlay .overlay-content,
  #image-overlay .overlay-content {
    padding: 0.8rem;
    width: 94vw;          /* ç”»é¢ã‚ˆã‚Šã¡ã‚‡ã£ã¨å°ã•ã */
    max-width: 94vw;
    max-height: 88vh;     /* ä¸Šä¸‹ã«ã‚‚ä½™ç™½ã‚’æ®‹ã™ */
    margin: 6vh auto;     /* ä¸Šä¸‹ã«ä½™ç™½ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤æ„Ÿã‚’å‡ºã™ï¼‰ */
    border-radius: 8px;
  }

  .rainbow-label {
    width: 4.5em;
    font-size: 0.8rem;
  }
}

    

/* èª¬æ˜æ–‡ã‚’èª­ã¿ã‚„ã™ã„ç®‡æ¡æ›¸ãé¢¨ã«ã™ã‚‹ï¼ˆãƒ˜ãƒƒãƒ€ãƒ¼ã«ã¯åŠ¹ã‹ã›ãªã„ï¼‰ */
.description-text {
  display: block;
  margin: 0.6rem 0;
  position: relative;
  padding-left: 1.2em;
  line-height: 1.6;
}


/* æ–‡é ­ã«è¦‹ã‚„ã™ã„ãƒãƒ¼ã‚«ãƒ¼ã‚’è‡ªå‹•ã§è¿½åŠ  */
/* èª¬æ˜æ–‡ã ã‘ã«ãƒãƒ¼ã‚«ãƒ¼ã‚’ä»˜ã‘ã‚‹ */
.description-text {
  display: block;
  margin: 0.6rem 0;
  position: relative;
  padding-left: 1.2em;
  line-height: 1.7;
}

/* èª¬æ˜æ–‡å°‚ç”¨ã®ãƒãƒ¼ã‚«ãƒ¼ */
.description-text::before {
  content: "â—";
  position: absolute;
  left: 0;
  top: 0.2em;
  color: #3949ab;      /* è¦‹å‡ºã—ã¨åˆã‚ã›ãŸé’ç´« */
  font-weight: bold;
  font-size: 0.8rem;
}

/* ã‚¹ãƒãƒ›ã§å°‘ã—è¡Œé–“ã‚’åºƒã */
@media (max-width: 768px) {
  .description-text {
    line-height: 1.9;
    padding-left: 1.4em;
  }
}


/* ã‚¹ãƒãƒ›æ™‚ã¯å°‘ã—å¤§ãã‚ã®è¡Œé–“ã§èª­ã¿ã‚„ã™ã */
@media (max-width: 768px) {
  .note {
    line-height: 1.8;
    padding-left: 1.3em;
  }
}

/* ==========================
   åå‰ï¼‹å¹´é½¢ã®å°ã•ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ 
   ========================== */
.name-input-wrapper {
  margin: 0.5rem 0 0.9rem 0;
  padding: 0.4rem 0.6rem;
  border: 1px solid #dddddd;
  border-radius: 4px;
  background: #fafafa;
  display: inline-flex;
  flex-direction: column;
  gap: 0.2rem;
  font-size: 0.85rem;
}

/* 1è¡Œã”ã¨ã®ãƒ©ãƒ™ãƒ«ï¼ˆã€Œåå‰ï¼ˆè¡¨ç¤ºç”¨ï¼‰ï¼šã€ã€Œç¾åœ¨ã®å¹´é½¢ï¼šã€ï¼‰ */
.name-input-label {
  display: flex;          /* ãƒ†ã‚­ã‚¹ãƒˆã¨å…¥åŠ›æ¬„ã‚’æ¨ªã«ä¸¦ã¹ã‚‹ */
  align-items: center;
  gap: 0.4rem;
  color: #333;
}

/* æ ã®ä¸­ã®å…¥åŠ›æ¬„ï¼ˆåå‰ãƒ»å¹´é½¢ã©ã¡ã‚‰ã‚‚ï¼‰ */
.name-input-label input {
  margin-left: auto;      /* å…¥åŠ›æ¬„ã‚’å³ç«¯ã«ãã‚ãˆã‚‹ */
  padding: 0.15rem 0.35rem;
  font-size: 0.85rem;
  border: 1px solid #ccc;
  border-radius: 4px;
  width: 7em;             /* 2ã¤ã®å…¥åŠ›æ¬„ã‚’åŒã˜å¹…ã«ã™ã‚‹ */
  box-sizing: border-box;
}

/* ã‚¹ãƒãƒ›æ™‚ã¯ã€å°‘ã—ã ã‘ã‚³ãƒ³ãƒ‘ã‚¯ãƒˆã« */
@media (max-width: 768px) {
  .name-input-wrapper {
    margin: 0.4rem 0 0.8rem 0;
    padding: 0.35rem 0.5rem;
    font-size: 0.82rem;
  }

  .name-input-label {
    gap: 0.3rem;
  }

  .name-input-label input {
    font-size: 0.8rem;
    width: 6.5em;         /* ã‚¹ãƒãƒ›ã§ã¯å°‘ã—ã ã‘çŸ­ã */
  }
}

/* ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å°‚ç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
/* â€»åŠå††ã‚°ãƒ©ãƒ•ã®ç¸¦æ¨ªæ¯”ã¯ãã®ã¾ã¾ï¼ç”»åƒã¯ã¯ã¿å‡ºã•ãšæœ€å¤§è¡¨ç¤º */

/* ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å°‚ç”¨ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆèª¿æ•´ */
#image-overlay .overlay-content {
  max-width: min(900px, 94vw);   /* PC ã§ã‚‚ã‚¹ãƒãƒ›ã§ã‚‚ã€Œå°‘ã—å°ã•ã‚ã€ */
  max-height: 88vh;
  margin: 6vh auto;
  padding: 0.75rem;
  display: flex;
  flex-direction: column;        /* ä¸Šï¼šãƒ˜ãƒƒãƒ€ãƒ¼ã€ä¸‹ï¼šç”»åƒ ã®ç¸¦ä¸¦ã³ */
  align-items: center;           /* æ¨ªæ–¹å‘ã¯ä¸­å¤®å¯„ã› */
  justify-content: flex-start;   /* ä¸Šã‹ã‚‰é †ã«é…ç½® */
  background: #fff;
  border-radius: 8px;
  box-sizing: border-box;
  position: relative;
}


#image-overlay #captured-image {
  max-width: 100%;
  max-height: calc(88vh - 3rem); /* ãƒ˜ãƒƒãƒ€ãƒ¼ï¼‹ä½™ç™½ã¶ã‚“å·®ã—å¼•ã */
  width: auto;
  height: auto;
  object-fit: contain;
  display: block;
}


/* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã¯å³ä¸Šå›ºå®šï¼ˆæ—¢å­˜ã®æŒ‡å®šã¨ã»ã¼åŒã˜ã ãŒã€å¿µã®ãŸã‚ï¼‰ */
#image-overlay .btn-close {
  position: absolute;
  top: 8px;
  right: 8px;
  z-index: 10;
}

/* ã‚¹ãƒãƒ›ï¼šå¹…å„ªå…ˆã§ãƒ•ã‚£ãƒƒãƒˆï¼ˆæ¯”ç‡ç¶­æŒï¼‰ */
@media (max-width: 768px) {
  #captured-image {
    max-width: 100vw;
    max-height: 100vh;
    width: auto;
    height: auto;
    object-fit: contain;
    display: block;
  }
}

/* å…¥åŠ›ä¸­ã‚»ãƒ«ã®ã‚„ã•ã—ã„æ·¡é»„è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ */
input[type="number"]:focus,
textarea.memo-input:focus {
  outline: none;
  background-color: #fff8d6 !important; /* æ·¡ã„é»„è‰² */
  box-shadow: 0 0 0 2px rgba(255, 227, 115, 0.6) inset; /* ã‚„ã‚ã‚‰ã‹ã„é»„è‰²è¼ªéƒ­ */
  transition: background-color 0.15s ease, box-shadow 0.15s ease;
}

/* ç¾åœ¨ã®ç¸¦åˆ—ã‚’ã€æ ç·šã ã‘å°‘ã—å¼·èª¿ã—ã¦è¦‹ã¤ã‘ã‚„ã™ãã™ã‚‹ */
#main-table thead th:nth-child(4),
#main-table tbody td:nth-child(4),
#main-table tfoot td:nth-child(4) {
  border-left: 2px solid #9fa8da;   /* å°‘ã—æ¿ƒã„ã‚ã®é’ç´«ã®ç¸¦ç·š */
  border-right: 2px solid #9fa8da;
}


/* èƒŒæ™¯è‰²ã¯ã€Œå…ƒã®è‰²ã‚ˆã‚Šã»ã‚“ã®å°‘ã—ã ã‘æ¿ƒã„ã€ãƒˆãƒ¼ãƒ³ã« */
#main-table thead th:nth-child(4) {
  background-color: #dce7ff;  /* æ—¢å­˜ã® #e3f2fd ã‚ˆã‚Šã¡ã‚‡ã£ã¨ã ã‘æ¿ƒã„ */
}

#main-table tbody td:nth-child(4),
#main-table tfoot td:nth-child(4) {
  background-color: #f2f4ff;  /* æ—¢å­˜ã® #fafbff ã‚ˆã‚Šã‚ãšã‹ã«æ¿ƒã„ */
}

/* PC ã®ã¨ãã ã‘ã€2ã¤ã®ãƒœã‚¿ãƒ³ã®æ¨ªå¹…ã‚’æƒãˆã‚‹ */
@media (min-width: 769px) {
  .buttons .btn-image,
  .buttons .btn-rainbow {
    min-width: 14.5rem;   /* â˜… ã“ã“ã§ã€Œå¤§ãã„æ–¹ã€ã«åˆã‚ã›ã‚‹ã€‚æ•°å€¤ã¯å¾®èª¿æ•´å¯ */
    justify-content: center;
  }
}

  </style>
</head>
<body>
  <div class="container">
    <h1>ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼<wbr>ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ</h1>

<ul class="description-list">
  <li>ç¾åœ¨ã®å¹´é½¢ã‚’å…¥ã‚Œã‚‹ã¨ã€å„æ™‚ç‚¹ã®å¹´é½¢ãŒè‡ªå‹•ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</li>
  <li>å„ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«(å½¹å‰²)ã®é‡è¦åº¦(ï¼…)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</li>
  <li>ç¸¦ã®åˆ—(20å¹´å‰ï½ç†æƒ³)ã®åˆè¨ˆãŒãã‚Œãã‚Œ100ï¼…ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´ã—ã¾ã™ã€‚</li>
  <li>ãƒ¡ãƒ¢æ¬„ã«ã¯ãã®æ™‚æœŸã®ã§ãã”ã¨ã‚„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’è‡ªç”±ã«æ›¸ã„ã¦ãã ã•ã„ã€‚(ç©ºæ¬„ã§ã‚‚OK)</li>
  <li>â€»ãƒ‡ãƒ¼ã‚¿ã¯ã“ã®ãƒ–ãƒ©ã‚¦ã‚¶å†…ã ã‘ã§ä½¿ã‚ã‚Œã€ã©ã“ã«ã‚‚é€ä¿¡ã•ã‚Œã¾ã›ã‚“ã€‚</li>
</ul>

<!-- â˜… æ–°ã—ã„ã€Œå°ã•ãªãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ ã€ -->
<div class="name-input-wrapper">
  <label class="name-input-label">
    åå‰(è¡¨ç¤ºç”¨)ï¼š
    <input id="user-name" type="text" maxlength="40" />
  </label>
  <label class="name-input-label">
    ç¾åœ¨ã®å¹´é½¢ï¼š
    <input
      id="age-now"
      type="number"
      min="0"
      max="120"
      placeholder="ä¾‹ï¼š35"
    />
  </label>
</div>

<h2>ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åˆ¥ã®é‡è¦åº¦ã®å‰²åˆ(ï¼…)</h2>

    <div class="table-wrapper">
      <table id="main-table">
        <thead>
  <tr>
    <th>
      <div class="th-box">
        ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«<br>ï¼ˆå½¹å‰²ï¼‰
      </div>
    </th>

    <th>
      <div class="th-box">
        20å¹´å‰
        <span class="note">ï¼ˆ<span id="age-20ago">-</span>æ­³é ƒï¼‰</span>
      </div>
    </th>

    <th>
      <div class="th-box">
        10å¹´å‰
        <span class="note">ï¼ˆ<span id="age-10ago">-</span>æ­³é ƒï¼‰</span>
      </div>
    </th>

    

<th>
  <div class="th-box">
    ç¾åœ¨
    <span class="note">ï¼ˆ<span id="age-now-display">-</span>æ­³ï¼‰</span>
  </div>
</th>



    <th>
      <div class="th-box">
        10å¹´å¾Œ
        <span class="note">ï¼ˆ<span id="age-10after">-</span>æ­³é ƒï¼‰</span>
      </div>
    </th>

    <th>
      <div class="th-box">
        20å¹´å¾Œ
        <span class="note">ï¼ˆ<span id="age-20after">-</span>æ­³é ƒï¼‰</span>
      </div>
    </th>

    <th>
      <div class="th-box">
        ç†æƒ³
      </div>
    </th>
  </tr>
</thead>
        <tbody>
          <!-- å­ã©ã‚‚ -->
          <tr>
            
  <th>
    <div class="role-cell">
      <div class="role-name">å­ã©ã‚‚</div>
      <div class="role-desc">
        å­ã©ã‚‚ã¨ã—ã¦è¦ªã¨é–¢ã‚ã‚‹å½¹å‰²ã€‚ä»‹è­·ãªã©ã‚‚å«ã‚€
      </div>
    </div>
  </th>

            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- å­¦ç”Ÿ -->
          <tr>
            
  <th>
    <div class="role-cell">
      <div class="role-name">å­¦ç”Ÿ</div>
      <div class="role-desc">
        å­¦æ ¡ãƒ»è³‡æ ¼å–å¾—ãƒ»ç ”ä¿®ãªã©
      </div>
    </div>
  </th>

            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- ä½™æš‡ãƒ»è¶£å‘³ -->
          <tr>
            
  <th>
    <div class="role-cell">
      <div class="role-name">ä½™æš‡ãƒ»è¶£å‘³</div>
      <div class="role-desc">
        è¶£å‘³ã‚„ã‚¹ãƒãƒ¼ãƒ„ã€å‹äººã¨ã®äº¤æµãªã©ã‚’æ¥½ã—ã‚€æ™‚é–“
      </div>
    </div>
  </th>

            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- åœ°åŸŸç¤¾ä¼š -->
          <tr>
            <th>
    <div class="role-cell">
      <div class="role-name">åœ°åŸŸç¤¾ä¼š</div>
      <div class="role-desc">
        åœ°åŸŸã‚„ç¤¾ä¼šã¨é–¢ã‚ã‚‹å½¹å‰²ã€‚PTAãƒ»ãƒœãƒ©ãƒ³ãƒ†ã‚£ã‚¢ãªã©ã‚‚å«ã‚€
      </div>
    </div>
  </th>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- ä»•äº‹ -->
          <tr>
            <th>
    <div class="role-cell">
      <div class="role-name">ä»•äº‹</div>
      <div class="role-desc">
        åå…¥ã‚’å¾—ã‚‹ä»•äº‹å…¨èˆ¬ã€‚ã‚¢ãƒ«ãƒã‚¤ãƒˆãªã©ã‚‚å«ã‚€
      </div>
    </div>
  </th>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ -->
          <tr>
            <th>
    <div class="role-cell">
      <div class="role-name">ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼</div>
      <div class="role-desc">
        é…å¶è€…ã‚„ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼ã¨å‘ãåˆã†æ™‚é–“ã‚„é–¢ä¿‚ã¥ãã‚Š
      </div>
    </div>
  </th>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- å®¶äº‹ -->
          <tr>
            <th>
    <div class="role-cell">
      <div class="role-name">å®¶äº‹</div>
      <div class="role-desc">
        å®¶æ—ãŒæš®ã‚‰ã—ã‚„ã™ã„ç’°å¢ƒã‚’æ•´ãˆã‚‹å½¹å‰²
      </div>
    </div>
  </th>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
          <!-- è¦ª -->
          <tr>
            <th>
    <div class="role-cell">
      <div class="role-name">è¦ª</div>
      <div class="role-desc">
        è¦ªã¨ã—ã¦å­ã©ã‚‚ã¨é–¢ã‚ã‚‹å½¹å‰²
      </div>
    </div>
  </th>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10ago" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="now" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t10after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="t20after" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
            <td><div class="cell-content"><div class="percent-block"><input type="number" min="0" max="100" data-time="ideal" /><span class="percent-label">%</span></div><textarea class="memo-input"  placeholder="ãƒ¡ãƒ¢"></textarea></div></td>
          </tr>
        </tbody>
        <tfoot>
          <tr class="sum-row">
            <th>å„æ™‚ç‚¹ã®åˆè¨ˆ</th>
            <td id="sum-t20ago">0%</td>
            <td id="sum-t10ago">0%</td>
            <td id="sum-now">0%</td>
            <td id="sum-t10after">0%</td>
            <td id="sum-t20after">0%</td>
            <td id="sum-ideal">0%</td>
          </tr>
        </tfoot>
      </table>
    </div>

   <div class="buttons">
  <button type="button" id="reset-btn" class="btn btn-reset">ãƒªã‚»ãƒƒãƒˆ</button>
  <!-- å…ˆã«ç”»åƒåŒ–ãƒœã‚¿ãƒ³ -->
  
<button type="button" id="image-btn" class="btn btn-image">
  <i class="fa-solid fa-image"></i> å…¥åŠ›å†…å®¹ã‚’ç”»åƒã«ã™ã‚‹
</button>

  <!-- å¾Œã‚ã«ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ãƒœã‚¿ãƒ³ -->
  
<button type="button" id="rainbow-btn" class="btn btn-rainbow">
  <i class="fa-solid fa-rainbow"></i> ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚’è¦‹ã‚‹
</button>

</div>
  </div>

  <!-- ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="rainbow-overlay" class="overlay hidden">
    <div class="overlay-content" id="rainbow-wrapper">
      <div class="overlay-header">
  <h2>ã‚ãªãŸã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ğŸŒˆ</h2>
  <button type="button" id="rainbow-close" class="btn btn-close">Ã—</button>
</div>
<p class="note">
  å„æ™‚ç‚¹ã®é‡è¦åº¦ã®å‰²åˆã‚’è‰²ã®å¸¯ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚<br />
</p>

<canvas id="rainbow-canvas"></canvas>
<!-- ã‚­ãƒ£ãƒ³ãƒã‚¹ä¸Šã«é‡ã­ã‚‹ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
<div id="rainbow-tooltip"></div>

<!-- æ—¢å­˜ã®å‡¡ä¾‹ã‚³ãƒ³ãƒ†ãƒŠï¼ˆä½¿ã‚ãªã„ã®ã§CSSå´ã§éè¡¨ç¤ºã«ã—ã¾ã™ï¼‰ -->
<div id="rainbow-legend" class="rainbow-legend"></div>
    </div>
  </div>
<!-- ç”»åƒè¡¨ç¤ºç”¨ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="image-overlay" class="overlay hidden">
    <div class="overlay-content" id="image-overlay-wrapper">
      <div class="overlay-header">
        <button type="button" id="image-overlay-close" class="btn btn-close">Ã—</button>
      </div>
      <!-- ç”Ÿæˆã—ãŸç”»åƒã‚’ã“ã“ã«è¡¨ç¤º -->
      <img id="captured-image" src="" alt="ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆç”»åƒ" />

<p style="font-size: 0.75rem; color: #666; margin-top: 0.3rem; text-align: center;">
  â€»é•·æŠ¼ã—/å³ã‚¯ãƒªãƒƒã‚¯ã§ç”»åƒä¿å­˜ã§ãã¾ã™
</p>

    </div>
  </div>


  <!-- ç”»åƒåŒ–ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª -->
<!-- ã‚°ãƒ©ãƒ•æç”»ç”¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
 <script>
// å¹´é½¢è¨ˆç®—
const ageNowInput = document.getElementById("age-now");
const age20agoSpan = document.getElementById("age-20ago");
const age10agoSpan = document.getElementById("age-10ago");
const age10afterSpan = document.getElementById("age-10after");
const age20afterSpan = document.getElementById("age-20after");

// â˜… ç¾åœ¨ã®å¹´é½¢è¡¨ç¤ºç”¨ï¼ˆã€Œç¾åœ¨ã€ã®åˆ—ã®ï¼ˆâ—¯æ­³é ƒï¼‰ï¼‰
const ageNowSpan = document.getElementById("age-now-display");


// åå‰å…¥åŠ›
const userNameInput = document.getElementById("user-name");

// ãƒˆãƒªãƒ ã—ãŸåå‰ã‚’å–å¾—ï¼ˆç©ºãªã‚‰ "" ã‚’è¿”ã™ï¼‰
function getUserName() {
  if (!userNameInput) return "";
  return userNameInput.value.trim();
}

function updateAges() {
  const now = Number(ageNowInput.value);
  if (Number.isFinite(now) && now > 0) {
    // 20å¹´å‰ã€œ20å¹´å¾Œ
    age20agoSpan.textContent = Math.max(now - 20, 0);
    age10agoSpan.textContent = Math.max(now - 10, 0);
    age10afterSpan.textContent = now + 10;
    age20afterSpan.textContent = now + 20;

    // â˜… ç¾åœ¨ï¼ˆå¹´é½¢ï¼‰ã‚’è¡¨ç¤º
    if (ageNowSpan) {
      ageNowSpan.textContent = now;
    }
  } else {
    age20agoSpan.textContent = "-";
    age10agoSpan.textContent = "-";
    age10afterSpan.textContent = "-";
    age20afterSpan.textContent = "-";

    // â˜… å…¥åŠ›ãŒç©ºãªã©ã®ã¨ãã¯ã€Œ-ã€ã«æˆ»ã™
    if (ageNowSpan) {
      ageNowSpan.textContent = "-";
    }
  }
}
ageNowInput.addEventListener("input", updateAges);

// åˆè¨ˆè¨ˆç®—
const timeKeys = ["t20ago", "t10ago", "now", "t10after", "t20after", "ideal"];


function updateSums() {
  const inputs = document.querySelectorAll(
    "tbody input[type='number'][data-time]"
  );
  const sums = { t20ago: 0, t10ago: 0, now: 0, t10after: 0, t20after: 0, ideal: 0 };

  // å„åˆ—ï¼ˆæ™‚é–“è»¸ï¼‰ã®åˆè¨ˆã‚’é›†è¨ˆ
  inputs.forEach((input) => {
    const time = input.getAttribute("data-time");
    const value = Number(input.value);
    if (Number.isFinite(value)) {
      sums[time] += value;
    }
  });

  // æ™‚é–“è»¸ã”ã¨ã«ãƒ•ãƒƒã‚¿ãƒ¼ã¨åˆ—ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’æ›´æ–°
  timeKeys.forEach((key, index) => {
    const total = sums[key];

    // 1) ãƒ•ãƒƒã‚¿ãƒ¼ã®è¡¨ç¤ºãƒ»OK/WARNã‚¯ãƒ©ã‚¹
    const sumCell = document.getElementById("sum-" + key);
    if (!sumCell) return;

    sumCell.textContent = total + "%";
    sumCell.classList.remove("sum-ok", "sum-warn");

    if (total === 100) {
      sumCell.classList.add("sum-ok");
      sumCell.textContent = total + "%ï¼ˆOKï¼‰";
    } else {
      sumCell.classList.add("sum-warn");
    }

    // 2) å¯¾è±¡åˆ—ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ï¼ˆ1åˆ—ç›®ï¼šãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«ã€2åˆ—ç›®ï¼št20agoâ€¦ï¼‰
    const colIndex = index + 2; // timeKeys[0] â†’ 2åˆ—ç›®, â€¦, timeKeys[5] â†’ 7åˆ—ç›®

    // å¯¾è±¡åˆ—ã® thead / tbody / tfoot ã‚»ãƒ«ã‚’ã™ã¹ã¦å–å¾—
    const colCells = document.querySelectorAll(
      "#main-table thead th:nth-child(" + colIndex + "), " +
      "#main-table tbody td:nth-child(" + colIndex + "), " +
      "#main-table tfoot td:nth-child(" + colIndex + ")"
    );

    // 3) ã„ã£ãŸã‚“æ—¢å­˜ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’å¤–ã™
    colCells.forEach((cell) => {
      cell.classList.remove("col-perfect", "col-over");
    });

    // 4) åˆè¨ˆå€¤ã«å¿œã˜ã¦ã‚¯ãƒ©ã‚¹ã‚’ä»˜ã‘ã‚‹
    if (total === 100) {
      colCells.forEach((cell) => cell.classList.add("col-perfect"));
    } else if (total > 100) {
      colCells.forEach((cell) => cell.classList.add("col-over"));
    }
    // 100æœªæº€ã®ã¨ãã¯ä½•ã‚‚ä»˜ã‘ãªã„ï¼ˆé€šå¸¸è‰²ï¼‰
  });
}


document.addEventListener("input", (e) => {
  if (e.target.matches("tbody input[type='number'][data-time]")) {
    updateSums();
  }
});

// ãƒ¡ãƒ¢ã®è¦‹ãŸç›®
function updateMemoAppearance(input) {
  if (input.value && input.value.trim().length > 0) {
    input.classList.add("memo-active");
  } else {
    input.classList.remove("memo-active");
  }
}

function autoResizeMemo(el) {
  // é«˜ã•ã¯å›ºå®šã™ã‚‹ï¼ˆã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã«ä»»ã›ã‚‹ï¼‰
  el.style.height = el.style.maxHeight;
}

const memoInputs = document.querySelectorAll(".memo-input");
memoInputs.forEach((input) => {
  // åˆæœŸè¡¨ç¤º
  updateMemoAppearance(input);
  autoResizeMemo(input);

  // å…¥åŠ›ä¸­ï¼šè‰²ã‚’å¤‰ãˆã¤ã¤é«˜ã•ã‚‚åˆã‚ã›ã‚‹
  input.addEventListener("input", () => {
    updateMemoAppearance(input);
    autoResizeMemo(input);
  });

  // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ™‚ï¼šã¨ã‚Šã‚ãˆãšå…¨æ–‡ãŒè¦‹ãˆã‚‹é«˜ã•ã«
  input.addEventListener("focus", () => {
    autoResizeMemo(input);
  });

  // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ãŒå¤–ã‚ŒãŸã¨ã
  input.addEventListener("blur", () => {
    updateMemoAppearance(input);
    if (!input.value.trim()) {
      // æœªå…¥åŠ›ã®å ´åˆã¯æœ€å°ã‚µã‚¤ã‚ºã¾ã§æˆ»ã™
      input.style.height = "";
    }
  });
});

// ãƒªã‚»ãƒƒãƒˆ
const resetBtn = document.getElementById("reset-btn");
resetBtn.addEventListener("click", () => {
  ageNowInput.value = "";
  updateAges();

  document
    .querySelectorAll("tbody input[type='number'][data-time]")
    .forEach((input) => {
      input.value = "";
    });

  memoInputs.forEach((input) => {
    input.value = "";
    updateMemoAppearance(input);
  input.style.height = ""; // â˜… é«˜ã•ã‚‚åˆæœŸçŠ¶æ…‹ã«
  });

  updateSums();
});

// HTMLã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
function escapeHtml(str) {
  return String(str)
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#39;");
}

// ãƒ¡ãƒ¢ã‚’ã€Œæ”¹è¡Œæœ‰åŠ¹ã€ã§æ•´å½¢ã—ã¦HTMLæ–‡å­—åˆ—ã«ã™ã‚‹ï¼ˆåˆ¶é™ãªã—ç‰ˆï¼‰
function formatMemoForHtml(memoText) {
  if (!memoText) return "";

  // å…¨æ–‡ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã€æ”¹è¡Œã ã‘ <br> ã«ç½®ãæ›ãˆã‚‹
  return escapeHtml(memoText).replace(/\r?\n/g, "<br>");
}

// ç”»åƒåŒ–ãƒœã‚¿ãƒ³
const imageBtn = document.getElementById("image-btn");
imageBtn.addEventListener("click", function () {
  const mainTable = document.getElementById("main-table");

  const printContainer = document.createElement("div");
ã€€printContainer.id = "print-container";   // â˜… ã“ã®1è¡Œã‚’è¿½åŠ 
  printContainer.style.position = "fixed";
  printContainer.style.left = "-9999px";
  printContainer.style.top = "0";
  printContainer.style.width = "900px"; // å°‘ã—ç´°ã‚ã«
  printContainer.style.backgroundColor = "#ffffff";
  printContainer.style.padding = "5";
  printContainer.style.boxSizing = "border-box";
  document.body.appendChild(printContainer);

  const title = document.createElement("h1");
const userName = getUserName();

title.textContent = userName
  ? userName + "ã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ"
  : "ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ";

title.style.textAlign = "center";
title.style.color = "#3949ab";
printContainer.appendChild(title);

  const h2 = document.createElement("h2");
  h2.textContent = "ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åˆ¥ã®é‡è¦åº¦ã®å‰²åˆï¼ˆï¼…ï¼‰";
  h2.style.textAlign = "center";
  h2.style.color = "#3949ab";
  h2.style.marginTop = "10px";
  printContainer.appendChild(h2);

  const printTable = document.createElement("table");
  printTable.style.width = "100%";
  printTable.style.borderCollapse = "collapse";
  printTable.style.marginTop = "10px";
  printContainer.appendChild(printTable);


  // thead
  const origThead = mainTable.tHead;
  if (origThead) {
    const newThead = document.createElement("thead");
    const origHeadRow = origThead.rows[0];
    const newHeadRow = document.createElement("tr");

    for (let i = 0; i < origHeadRow.cells.length; i++) {
      const cell = origHeadRow.cells[i];
      const th = document.createElement("th");

      if (i === 0) {
        // 1åˆ—ç›®ã ã‘ã€æ˜ç¤ºçš„ã«æ”¹è¡Œã‚’å…¥ã‚Œã‚‹
        th.innerHTML = "ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«<br>ï¼ˆå½¹å‰²ï¼‰";
      } else {

// æ™‚ç‚¹ã‚»ãƒ«ï¼ˆ2åˆ—ç›®ã€œ6åˆ—ç›®ï¼‰ã¯å¼·åˆ¶2è¡Œã«æ•´å½¢ã™ã‚‹
if (i > 0 && i <= 5) {  
  const parts = cell.textContent.trim().split("ï¼ˆ");
  const title = parts[0];                  // ã€Œ20å¹´å‰ã€
  const age   = parts[1] ? "ï¼ˆ" + parts[1] : "";  // ã€Œï¼ˆâ—‹æ­³é ƒï¼‰ã€

  th.innerHTML = title + "<br>" + age;
} else {
  th.innerHTML = cell.innerHTML; // ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åˆ—ã‚„ç†æƒ³åˆ—ã¯ãã®ã¾ã¾
}

      }

      th.style.border = "1px solid #ddd";
      th.style.padding = "2px 4px";
      th.style.backgroundColor = "#e8eaf6";
      th.style.verticalAlign = "middle";
      newHeadRow.appendChild(th);
    }
    newThead.appendChild(newHeadRow);
    printTable.appendChild(newThead);
  }

  // tbody
const origTbody = mainTable.tBodies[0];
const newTbody = document.createElement("tbody");

for (let r = 0; r < origTbody.rows.length; r++) {
  const origRow = origTbody.rows[r];
  const newRow = document.createElement("tr");

  for (let c = 0; c < origRow.cells.length; c++) {
    const origCell = origRow.cells[c];
    let newCell;

    if (origCell.tagName === "TH") {
      // â˜… ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«åã ã‘å–å¾—ï¼ˆèª¬æ˜ã¯å«ã‚ãªã„ï¼‰
      newCell = document.createElement("th");

      const nameEl = origCell.querySelector(".role-name");
      const roleName = nameEl
        ? nameEl.textContent.trim()
        : origCell.textContent.trim(); // å¿µã®ãŸã‚ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

      newCell.textContent = roleName;
      newCell.style.backgroundColor = "#ede7f6";
      newCell.style.verticalAlign = "middle";
    } else {
      // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒˆï¼‹ãƒ¡ãƒ¢ï¼ˆæ—¢å­˜ã®å‡¦ç†ï¼‰
      newCell = document.createElement("td");

      const input = origCell.querySelector("input[type='number']");
      const textarea = origCell.querySelector("textarea");

      const rawValue =
        input && input.value !== "" ? Number(input.value) : null;

      const percentText =
        rawValue !== null ? rawValue + "ï¼…" : "";
      const memoText =
        textarea && textarea.value ? textarea.value : "";

      let html = "";

      if (percentText || memoText) {
        const formattedMemo = formatMemoForHtml(memoText);

        html +=
          "<div style='display:flex; align-items:center; " +
          "justify-content:space-between; gap:6px; width:100%;'>";

        html +=
          "<div style='font-weight:bold; white-space:nowrap; text-align:right; min-width:2em;'>" +
          escapeHtml(percentText || "") +
          "</div>";

        html +=
          "<div style='font-size:0.7em; line-height:1.3; text-align:left; flex:1;'>" +
          (formattedMemo || "") +
          "</div>";

        html += "</div>";
      }

      newCell.innerHTML = html;
      newCell.style.verticalAlign = "middle";

      if (rawValue !== null && rawValue >= 20) {
        newCell.style.backgroundImage =
          "repeating-linear-gradient(-45deg," +
          " rgba(255, 220, 220, 0.9) 0," +
          " rgba(255, 220, 220, 0.9) 4px," +
          " rgba(255, 255, 255, 0.9) 4px," +
          " rgba(255, 255, 255, 0.9) 8px)";
        newCell.style.backgroundColor = "#fff5f5";
      }
    }

    newCell.style.border = "1px solid #ddd";
    newCell.style.padding = "2px 4px";
    newRow.appendChild(newCell);
  }

  newTbody.appendChild(newRow);
}

printTable.appendChild(newTbody);

  // tfoot
  const origTfoot = mainTable.tFoot;
  if (origTfoot) {
    const newTfoot = document.createElement("tfoot");
    for (let r = 0; r < origTfoot.rows.length; r++) {
      const origRow = origTfoot.rows[r];
      const newRow = document.createElement("tr");
      for (let c = 0; c < origRow.cells.length; c++) {
        const origCell = origRow.cells[c];
        const td = document.createElement("td");
        td.textContent = origCell.textContent.trim();
        td.style.border = "1px solid #ddd";
        td.style.padding = "2px 4px";
        td.style.fontWeight = "bold";
        td.style.backgroundColor = "#fffde7";
        newRow.appendChild(td);
      }
      newTfoot.appendChild(newRow);
    }
    printTable.appendChild(newTfoot);
  }

// html2canvas ã§ç”»åƒåŒ–
  html2canvas(printContainer, {
    scale: 2,
    backgroundColor: "#ffffff",
    useCORS: true
  })
    .then(function (canvas) {
      const imgData = canvas.toDataURL("image/png");

      // ä¸€æ™‚ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤
      document.body.removeChild(printContainer);

      // â˜… ãƒšãƒ¼ã‚¸å†…ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹
      const imageOverlay = document.getElementById("image-overlay");
      const capturedImage = document.getElementById("captured-image");

      if (imageOverlay && capturedImage) {
        capturedImage.src = imgData;
        imageOverlay.classList.remove("hidden");
      } else {
        // ä¸‡ä¸€è¦ç´ ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã¯ã€ã¨ã‚Šã‚ãˆãšæ–°ã—ã„ã‚¿ãƒ–ã§é–‹ããƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        const win = window.open("");
        if (win) {
          win.document.write(
            "<!DOCTYPE html><html><head>" +
              "<meta charset='UTF-8' />" +
              "<meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover' />" +
              "<title>ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ï¼ˆç”»åƒï¼‰</title>" +
              "<style>" +
                "html,body{margin:0;padding:0;background:#ffffff;width:100%;height:100%;}" +
                "body{display:flex;justify-content:center;align-items:center;}" +
                "img{display:block;width:100vw;max-width:100vw;height:auto;}" +
              "</style>" +
            "</head><body>" +
              "<img src='" + imgData + "' alt='ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ãƒ»ãƒ¯ãƒ¼ã‚¯ã‚·ãƒ¼ãƒˆ' />" +
            "</body></html>"
          );
          win.document.close();
        }
      }
    })
    .catch(function (err) {
      alert("ç”»åƒã®ä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ãŠè©¦ã—ãã ã•ã„ã€‚");
      console.error(err);
      document.body.removeChild(printContainer);
    });
});



// ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
// ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å…±é€šã®é–‰ã˜ã‚‹å‡¦ç†ï¼ˆã“ã“ã‹ã‚‰ï¼‰
// ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
const imageOverlay = document.getElementById("image-overlay");
const imageOverlayClose = document.getElementById("image-overlay-close");

if (imageOverlay && imageOverlayClose) {
  // Ã—ãƒœã‚¿ãƒ³ã§é–‰ã˜ã‚‹
  imageOverlayClose.addEventListener("click", function () {
    imageOverlay.classList.add("hidden");
  });

  // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
  imageOverlay.addEventListener("click", function (e) {
    if (e.target === imageOverlay) {
      imageOverlay.classList.add("hidden");
    }
  });
}
// ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼
// ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤å…±é€šã®é–‰ã˜ã‚‹å‡¦ç†ï¼ˆã“ã“ã¾ã§ï¼‰
// ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼


// ãƒ©ã‚¤ãƒ•ãƒ­ãƒ¼ãƒ«ï¼ˆè¡Œï¼‰ã®åå‰ã‚’å–å¾—ï¼ˆãƒ©ãƒ™ãƒ«ã®ã¿ï¼‰
function getRoleNames() {
  const tbody = document.querySelector("#main-table tbody");
  const rows = Array.from(tbody.rows);

  return rows.map((row) => {
    const nameEl = row.querySelector(".role-name");
    // .role-name ãŒè¦‹ã¤ã‹ã‚Œã°ãã®ãƒ†ã‚­ã‚¹ãƒˆã ã‘ã‚’è¿”ã™
    if (nameEl) {
      return nameEl.textContent.trim();
    }
    // å¿µã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆå¤ã„æ§‹é€ ã®å ´åˆï¼‰
    return row.cells[0].textContent.trim();
  });
}


// 20å¹´å‰ã€œ20å¹´å¾Œã®5ç‚¹åˆ†ã®ãƒ©ãƒ™ãƒ«ã¨ã‚­ãƒ¼
function getTimeInfosWithAge() {
  const now = parseFloat(ageNowInput.value);
  if (!isNaN(now) && now > 0) {
    return [
      { key: "t20ago", label: Math.max(now - 20, 0) + "æ­³é ƒ" },
      { key: "t10ago", label: Math.max(now - 10, 0) + "æ­³é ƒ" },
      { key: "now", label: "ç¾åœ¨ " + now + "æ­³" },
      { key: "t10after", label: now + 10 + "æ­³é ƒ" },
      { key: "t20after", label: now + 20 + "æ­³é ƒ" }
    ];
  } else {
    return [
      { key: "t20ago", label: "âˆ’20å¹´" },
      { key: "t10ago", label: "âˆ’10å¹´" },
      { key: "now", label: "ç¾åœ¨" },
      { key: "t10after", label: "+10å¹´" },
      { key: "t20after", label: "+20å¹´" }
    ];
  }
}

// ===== åŠå††ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ï¼ˆã‚«ã‚¹ã‚¿ãƒ æç”»ï¼‰ =====
const rainbowBtn = document.getElementById("rainbow-btn");
const rainbowOverlay = document.getElementById("rainbow-overlay");
const rainbowCloseBtn = document.getElementById("rainbow-close");
const rainbowCanvas = document.getElementById("rainbow-canvas");
const rainbowLegendDiv = document.getElementById("rainbow-legend");


// targetCanvas ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã“ã«æç”»ã€ãªã‘ã‚Œã°é€šå¸¸ã® rainbowCanvas ã«æã

function buildRainbowChart(targetCanvas) {
  const canvas = targetCanvas || rainbowCanvas;
  if (!canvas) return;

  const dpr = window.devicePixelRatio || 1;

  // â–¼ è¿½åŠ ï¼šã‚­ãƒ£ãƒ³ãƒã‚¹ã®è¦ªè¦ç´ ã®å¹…ã‚’å„ªå…ˆçš„ã«ä½¿ã†
  const parent = canvas.parentElement;
  const parentWidth = parent
    ? parent.clientWidth || parent.getBoundingClientRect().width
    : 0;

  const viewportWidth =
    window.innerWidth || document.documentElement.clientWidth || 600;
  const viewportHeight =
    window.innerHeight || document.documentElement.clientHeight || 600;

  // ã€Œç”»é¢å¹…ã€ã¨ã€Œè¦ªè¦ç´ ã®å¹…ã€ã®ã†ã¡ã€ä¿¡é ¼ã§ãã‚‹ã»ã†ã‚’æ¡ç”¨
  // ãƒ»é€šå¸¸è¡¨ç¤ºï¼šè¦ªè¦ç´  â‰’ ç”»é¢å¹… â†’ è‡ªç„¶ã«æ±ºã¾ã‚‹
  // ãƒ»ç”»åƒç”¨ã‚³ãƒ³ãƒ†ãƒŠï¼šè¦ªè¦ç´  = 900px â†’ ãã¡ã‚‰ãŒå„ªå…ˆã•ã‚Œã‚‹
  const baseWidth = parentWidth > 0 ? parentWidth : viewportWidth;

  const isMobile = baseWidth <= 768;

  // æ¨ªæ–¹å‘ã¯ã‚³ãƒ³ãƒ†ãƒŠå¹…ã‚’ã»ã¼ã„ã£ã±ã„ä½¿ã†
  const width = Math.min(960, baseWidth * (isMobile ? 0.98 : 0.95));

  // ç¸¦æ–¹å‘ã¯æ¨ªå¹…ãƒ™ãƒ¼ã‚¹ã§æ±ºã‚ã‚‹ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶é«˜ã•ã«å¼•ããšã‚‰ã‚Œãªã„ã‚ˆã†ã«ï¼‰
  const targetHeightRatio = isMobile ? 0.7 : 0.55;
  const height = width * targetHeightRatio;

  // ä¸Šã®ä½™ç™½ã¨ãƒ©ãƒ™ãƒ«ç”¨ä½™ç™½ã‚’å°‘ã—æ§ãˆã‚ã«ã—ã¦ã€å††ã‚’å¤§ãã
  const marginTop = isMobile ? 30 : 35;
  const labelMargin = isMobile ? 40 : 35;

  const maxRByWidth = width / 2 - 16;
  const maxRByHeight = height - marginTop - labelMargin - 16;
  const outerR = Math.min(maxRByWidth, maxRByHeight);
  const innerR = outerR * 0.25;

  canvas.width = width * dpr;
  canvas.height = height * dpr;
  canvas.style.width = width + "px";
  canvas.style.height = height + "px";

  const ctx = canvas.getContext("2d");
  ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
  ctx.clearRect(0, 0, width, height);

// ä¸­å¿ƒä½ç½®
const centerX = width / 2;
const centerY = outerR + marginTop;

  const tbody = document.querySelector("#main-table tbody");
  const rows = Array.from(tbody.rows);
  const roleNames = getRoleNames();
  const timeInfos = getTimeInfosWithAge();
  const timeCount = timeInfos.length;
  const roleCount = roleNames.length;

  const angles = [];
  for (let i = 0; i < timeCount; i++) {
    const t = timeCount === 1 ? 0 : i / (timeCount - 1);
    angles.push(-Math.PI + Math.PI * t);
  }

  const roleColors = [
    "#FF6F91", // å­ã©ã‚‚
    "#FF9E6B", // å­¦ç”Ÿ
    "#FFD66B", // ä½™æš‡ãƒ»è¶£å‘³
    "#A5D76E", // åœ°åŸŸç¤¾ä¼š
    "#6ED4FF", // ä»•äº‹
    "#7F8CFF", // ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼
    "#CFA0FF", // å®¶äº‹
    "#FFB7CF"  // è¦ª
  ];

  const values = rows.map((row) =>
    timeInfos.map((info) => {
      const input = row.querySelector(
        "input[type='number'][data-time='" + info.key + "']"
      );
      const v = input && input.value ? Number(input.value) : 0;
      return Math.max(v, 0);
    })
  );

  function radiusFromPerc(p) {
    const clamped = Math.max(0, Math.min(100, p));
    const ratio = clamped / 100;
    return innerR + (outerR - innerR) * ratio;
  }

  const lowerPerc = [];
  const upperPerc = [];
  for (let r = 0; r < roleCount; r++) {
    lowerPerc[r] = new Array(timeCount).fill(0);
    upperPerc[r] = new Array(timeCount).fill(0);
  }

  for (let tIdx = 0; tIdx < timeCount; tIdx++) {
    let cum = 0;
    for (let rIdx = 0; rIdx < roleCount; rIdx++) {
      lowerPerc[rIdx][tIdx] = cum;
      const v = values[rIdx][tIdx] || 0;
      cum += v;
      upperPerc[rIdx][tIdx] = cum;
    }
  }

  const stepsPerSegment = 40;

  for (let roleIndex = 0; roleIndex < roleCount; roleIndex++) {
    const color = roleColors[roleIndex % roleColors.length];

    const smoothAngles = [];
    const smoothLower = [];
    const smoothUpper = [];

    for (let j = 0; j < timeCount - 1; j++) {
      for (let s = 0; s < stepsPerSegment; s++) {
        const tt = s / stepsPerSegment;
        const ang = angles[j] * (1 - tt) + angles[j + 1] * tt;
        const low =
          lowerPerc[roleIndex][j] +
          (lowerPerc[roleIndex][j + 1] - lowerPerc[roleIndex][j]) * tt;
        const up =
          upperPerc[roleIndex][j] +
          (upperPerc[roleIndex][j + 1] - upperPerc[roleIndex][j]) * tt;

        smoothAngles.push(ang);
        smoothLower.push(low);
        smoothUpper.push(up);
      }
    }

    smoothAngles.push(angles[timeCount - 1]);
    smoothLower.push(lowerPerc[roleIndex][timeCount - 1]);
    smoothUpper.push(upperPerc[roleIndex][timeCount - 1]);

    ctx.beginPath();
    for (let k = 0; k < smoothAngles.length; k++) {
      const angOuter = smoothAngles[k];
      const rOuter = radiusFromPerc(smoothUpper[k]);
      const xOuter = centerX + rOuter * Math.cos(angOuter);
      const yOuter = centerY + rOuter * Math.sin(angOuter);
      if (k === 0) ctx.moveTo(xOuter, yOuter);
      else ctx.lineTo(xOuter, yOuter);
    }
    for (let k2 = smoothAngles.length - 1; k2 >= 0; k2--) {
      const angInner = smoothAngles[k2];
      const rInner = radiusFromPerc(smoothLower[k2]);
      const xInner = centerX + rInner * Math.cos(angInner);
      const yInner = centerY + rInner * Math.sin(angInner);
      ctx.lineTo(xInner, yInner);
    }
    ctx.closePath();

    ctx.fillStyle = color + "E6";
    ctx.fill();
    ctx.strokeStyle = "rgba(255,255,255,0.8)";
    ctx.lineWidth = 1;
    ctx.stroke();
  }

  ctx.beginPath();
  ctx.arc(centerX, centerY, outerR, -Math.PI, 0);
  ctx.strokeStyle = "rgba(0,0,0,0.25)";
  ctx.lineWidth = 1;
  ctx.stroke();

// --- å¹´é½¢ãƒ©ãƒ™ãƒ«ï¼ˆè§’åº¦ã¤ãé…ç½®ï¼šåŠå††ã«æ²¿ã‚ã›ã‚‹ï¼‰ ---
const labelFontPx = isMobile ? 12 : 16;

ctx.font =
  labelFontPx +
  "px system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
ctx.fillStyle = "#333";
ctx.textBaseline = "middle";
ctx.textAlign = "center";

// â˜… ãƒ©ãƒ™ãƒ«ã®è§’åº¦ï¼ˆã‚ãªãŸã®å¸Œæœ›ã«åˆã‚ã›ãŸå€¤ï¼‰
const labelAnglesDeg = [-88, -45, 0, 45, 88];  // 20å¹´å‰ã€œ20å¹´å¾Œã®5ç‚¹

// â˜… ãƒ†ã‚­ã‚¹ãƒˆã‚’ç½®ãåŠå¾„ï¼ˆã‚„ã‚„å†…å´ï¼è¦‹åˆ‡ã‚Œã«ãã„ï¼‰
// â˜… åŠå††ã‹ã‚‰1ã€œ2ãƒã‚¤ãƒ³ãƒˆã ã‘å¤–ã¸é›¢ã™ï¼ˆæœ€çµ‚èª¿æ•´ï¼‰
const labelRadius = outerR + (isMobile ? 7 : 9);

for (let i = 0; i < timeCount; i++) {
  let angleRad = angles[i];

  // ãƒ©ãƒ™ãƒ«ä½ç½®ã®åº§æ¨™ï¼ˆå›è»¢å‰ï¼‰
  let x = centerX + labelRadius * Math.cos(angleRad);
  let y = centerY + labelRadius * Math.sin(angleRad);

  // ãƒ©ãƒ™ãƒ«å›è»¢è§’åº¦ã®ãƒ©ã‚¸ã‚¢ãƒ³
  let rotateRad = (labelAnglesDeg[i] * Math.PI) / 180;

  ctx.save();           // Canvas çŠ¶æ…‹ã‚’ä¿å­˜
  ctx.translate(x, y);  // åŸç‚¹ã‚’ãƒ©ãƒ™ãƒ«ä½ç½®ã¸ç§»å‹•
  ctx.rotate(rotateRad);// æŒ‡å®šè§’åº¦ã¶ã‚“Canvasã‚’å›è»¢
  ctx.fillText(timeInfos[i].label, 0, 0);  // åŸç‚¹ã«æç”»ï¼ˆå›è»¢å¾Œåº§æ¨™ï¼‰
  ctx.restore();        // çŠ¶æ…‹ã‚’å…ƒã«æˆ»ã™ï¼ˆå¿…é ˆï¼‰
}




// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ãƒ©ãƒ™ãƒ«è¡¨ç¤ºç”¨ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æº–å‚™ï¼ˆæœ€å¤§å€¤ã®æ™‚é–“è»¸ã«ãƒ©ãƒ™ãƒ«ï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const timeIndexByKey = {};
timeInfos.forEach((info, idx) => {
  timeIndexByKey[info.key] = idx;
});

// å„æ™‚ç‚¹ï¼ˆ5ã¤ï¼‰ã«å¯¾å¿œã™ã‚‹ã‚­ãƒ¼é †
const timeKeysForLabel = ["t20ago", "t10ago", "now", "t10after", "t20after"];

// è§’åº¦ï¼ˆlabels ã‚’ç½®ãè§’åº¦ã¯å„æ™‚ç‚¹ã®è§’åº¦ï¼‰
const angleByTime = {};
timeKeysForLabel.forEach((k, i) => {
  angleByTime[k] = angles[i];
});

// â˜… ãƒ•ã‚©ãƒ³ãƒˆè¨­å®š
const roleFontPx = isMobile ? 11 : 14; 
ctx.font =
  roleFontPx +
  "px system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif";
ctx.fillStyle = "#111";
ctx.textBaseline = "middle";
ctx.textAlign = "center";

// æ™‚ç‚¹ã”ã¨ã®ãƒ©ãƒ™ãƒ«é…ç½®ç”¨ã®è§’åº¦ã‚ºãƒ©ã—ï¼ˆé‡ãªã‚Šå¯¾ç­–ï¼‰
const angleShiftDeg = 4;
const angleShift = (Math.PI / 180) * angleShiftDeg;


// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ãƒ­ãƒ¼ãƒ«ã”ã¨ã«ã€Œæœ€ã‚‚å‰²åˆãŒå¤§ãã„æ™‚ç‚¹ã€ã‚’æ¢ã—ã€ãã®å¸¯ã®ä¸­å¿ƒã«ãƒ©ãƒ™ãƒ«
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
for (let rIdx = 0; rIdx < roleCount; rIdx++) {
  const rowValues = values[rIdx]; // [t20, t10, now, t10after, t20after]

  // æœ€å¤§å€¤ã®ä½ç½®ï¼ˆã©ã®æ™‚ç‚¹ã§ä¸€ç•ªå‰²åˆãŒå¤§ãã„ã‹ï¼‰
  let maxVal = -1;
  let maxIndex = -1;

  for (let t = 0; t < timeKeysForLabel.length; t++) {
    const v = rowValues[t];
    if (v > maxVal) {
      maxVal = v;
      maxIndex = t;
    }
  }

  // ã™ã¹ã¦ 0ï¼…ãªã‚‰ãƒ©ãƒ™ãƒ«ã¯è¡¨ç¤ºã—ãªã„
  if (maxVal <= 0) continue;

  const timeKey = timeKeysForLabel[maxIndex];

  // =================================================
  // â‘  è§’åº¦ï¼š20å¹´å‰ï¼20å¹´å¾Œã ã‘ã€10å¹´å‰ï¼10å¹´å¾Œå´ã«å°‘ã—å¯„ã›ã‚‹
  // =================================================
  let baseAngle;   // ã“ã®å¾Œã§ labelAngle ã¨ã—ã¦ãã®ã¾ã¾ä½¿ã†
  let low;         // å¸¯ã®ä¸‹ç«¯ï¼ˆï¼…ã®ç´¯ç©ï¼‰
  let up;          // å¸¯ã®ä¸Šç«¯ï¼ˆï¼…ã®ç´¯ç©ï¼‰

  // ã©ã®ãã‚‰ã„ã€Œéš£ã®æ™‚ç‚¹ã€ã«å¯„ã›ã‚‹ã‹ï¼ˆ0ã€œ1ï¼‰
  // 0.0 ãªã‚‰å…ƒã®ã¾ã¾ã€0.5 ãªã‚‰å®Œå…¨ãªä¸­é–“
  const edgeShiftRatio = 0.25;   // â† 25% ã ã‘éš£ã®æ™‚ç‚¹å¯„ã‚Šï¼ˆãŠå¥½ã¿ã§ 0.2ã€œ0.3 ç¨‹åº¦ï¼‰

  if (timeKey === "t20ago") {
    // index 0: 20å¹´å‰, index 1: 10å¹´å‰
    const idxA = 0;  // 20å¹´å‰
    const idxB = 1;  // 10å¹´å‰
    const wA = 1 - edgeShiftRatio;
    const wB = edgeShiftRatio;

    // è§’åº¦ã‚‚ã€ä¸Šä¸‹ã®ä½ç½®ã‚‚ã€Œ20å¹´å‰ã€ã¨ã€Œ10å¹´å‰ã€ã®é–“ã«è£œé–“ã™ã‚‹
    baseAngle = angles[idxA] * wA + angles[idxB] * wB;
    low       = lowerPerc[rIdx][idxA] * wA + lowerPerc[rIdx][idxB] * wB;
    up        = upperPerc[rIdx][idxA] * wA + upperPerc[rIdx][idxB] * wB;

  } else if (timeKey === "t20after") {
    // æœ€å¾Œã® index: 20å¹´å¾Œ, ãã®ä¸€ã¤å‰: 10å¹´å¾Œ
    const idxA = timeCount - 1;   // 20å¹´å¾Œ
    const idxB = timeCount - 2;   // 10å¹´å¾Œ
    const wA = 1 - edgeShiftRatio;
    const wB = edgeShiftRatio;

    baseAngle = angles[idxA] * wA + angles[idxB] * wB;
    low       = lowerPerc[rIdx][idxA] * wA + lowerPerc[rIdx][idxB] * wB;
    up        = upperPerc[rIdx][idxA] * wA + upperPerc[rIdx][idxB] * wB;

  } else {
    // ãã‚Œä»¥å¤–ï¼ˆ10å¹´å‰ï¼ç¾åœ¨ï¼10å¹´å¾Œï¼‰ã¯ã€å…ƒã®ä½ç½®ãã®ã¾ã¾
    baseAngle = angleByTime[timeKey];
    low       = lowerPerc[rIdx][maxIndex];
    up        = upperPerc[rIdx][maxIndex];
  }

  // =================================================
  // â‘¡ åŠå¾„ï¼šå¸¯ã®ã€Œä¸Šä¸‹ã®çœŸã‚“ä¸­ã€ï¼ˆã‚»ãƒ³ã‚¿ãƒªãƒ³ã‚°ï¼‰
  // =================================================
  const midPerc = (low + up) / 2;
  const radius  = radiusFromPerc(midPerc);

  // è§’åº¦ã¯ baseAngle ã®ã¾ã¾ï¼ˆé‡ãªã‚Šé˜²æ­¢ã®ã‚ºãƒ©ã—ã¯ã—ãªã„ï¼‰
  const labelAngle = baseAngle;

  const x = centerX + radius * Math.cos(labelAngle);
  const y = centerY + radius * Math.sin(labelAngle);

  ctx.fillText(roleNames[rIdx], x, y);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// å‡¡ä¾‹ã‚’æ›´æ–°ï¼ˆå…¨ãƒ­ãƒ¼ãƒ«ã‚’è¡¨ç¤ºï¼‰
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
if (rainbowLegendDiv) {
  rainbowLegendDiv.innerHTML = "";

  for (let i = 0; i < roleCount; i++) {
    const item = document.createElement("div");
    item.className = "rainbow-legend-item";

    const colorBox = document.createElement("span");
    colorBox.className = "rainbow-color-box";
    colorBox.style.backgroundColor = roleColors[i % roleColors.length];

    const label = document.createElement("span");
    label.textContent = roleNames[i];

    item.appendChild(colorBox);
    item.appendChild(label);
    rainbowLegendDiv.appendChild(item);
  }
}
}
 // â† ã“ã“ã§ buildRainbowChart é–¢æ•°ãŒçµ‚ã‚ã‚‹

// ã€Œãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚’è¦‹ã‚‹ã€ãƒœã‚¿ãƒ³ â†’ ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚’ç”»åƒåŒ–ã—ã¦è¡¨ç¤º
if (rainbowBtn) {
  rainbowBtn.addEventListener("click", function () {
    // 1. ç”»é¢å¤–ã«ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ç”¨ã®ã‚³ãƒ³ãƒ†ãƒŠã‚’ä½œæˆ
    const captureContainer = document.createElement("div");
    captureContainer.style.position = "fixed";
    captureContainer.style.left = "-9999px";
    captureContainer.style.top = "0";
    captureContainer.style.width = "900px";
    captureContainer.style.backgroundColor = "#ffffff";
    captureContainer.style.padding = "5";
    captureContainer.style.boxSizing = "border-box";
    document.body.appendChild(captureContainer);

    // ã‚¿ã‚¤ãƒˆãƒ«
const title = document.createElement("h2");
const userNameForRainbow = getUserName();

title.textContent = userNameForRainbow
  ? userNameForRainbow + "ã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ğŸŒˆ"
  : "ã‚ãªãŸã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ğŸŒˆ";

title.style.textAlign = "center";
title.style.color = "#3949ab";
captureContainer.appendChild(title);

    // èª¬æ˜ï¼ˆå…ƒã® note ã¨æƒãˆã‚‹ï¼‰
    const note = document.createElement("p");
    note.textContent = "å„æ™‚ç‚¹ã®é‡è¦åº¦ã®å‰²åˆã‚’è‰²ã®å¸¯ã§è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚";
    note.style.fontSize = "0.85rem";
    note.style.color = "#666";
    note.style.textAlign = "center";
    note.style.marginTop = "4px";
    captureContainer.appendChild(note);

    // ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ç”¨ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ï¼ˆã“ã“ã«åŠå††ãƒãƒ£ãƒ¼ãƒˆã‚’æãï¼‰
    const rainbowImageCanvas = document.createElement("canvas");
    captureContainer.appendChild(rainbowImageCanvas);

    // 2. ã“ã®ã‚­ãƒ£ãƒ³ãƒã‚¹ã«ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã‚’æç”»ï¼ˆæ—¢å­˜é–¢æ•°ã‚’å†åˆ©ç”¨ï¼‰
    buildRainbowChart(rainbowImageCanvas);

    // 3. ã‚³ãƒ³ãƒ†ãƒŠå…¨ä½“ã‚’ html2canvas ã§ç”»åƒåŒ–
    html2canvas(captureContainer, {
      scale: 2,
      backgroundColor: "#ffffff",
      useCORS: true
    })
      .then(function (canvas) {
        const imgData = canvas.toDataURL("image/png");

        // ä¸€æ™‚ã‚³ãƒ³ãƒ†ãƒŠã‚’å‰Šé™¤
        document.body.removeChild(captureContainer);

        // 4. æ—¢å­˜ã®ç”»åƒã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã«è¡¨ç¤ºï¼ˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ç”»åƒã¨åŒã˜ä»•çµ„ã¿ï¼‰
        const imageOverlay = document.getElementById("image-overlay");
        const capturedImage = document.getElementById("captured-image");

        if (imageOverlay && capturedImage) {
          capturedImage.src = imgData;
          imageOverlay.classList.remove("hidden");
        } else {
          // ä¸‡ä¸€å–å¾—ã§ããªã‹ã£ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼šåˆ¥ã‚¿ãƒ–ã§è¡¨ç¤º
          const win = window.open("");
          if (win) {
            win.document.write(
              "<!DOCTYPE html><html><head>" +
                "<meta charset='UTF-8' />" +
                "<meta name='viewport' content='width=device-width, initial-scale=1, viewport-fit=cover' />" +
                "<title>ã‚ãªãŸã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼ï¼ˆç”»åƒï¼‰</title>" +
                "<style>" +
                  "html,body{margin:0;padding:0;background:#ffffff;width:100%;height:100%;}" +
                  "body{display:flex;justify-content:center;align-items:center;}" +
                  "img{display:block;width:100vw;max-width:100vw;height:auto;}" +
                "</style>" +
              "</head><body>" +
                "<img src='" + imgData + "' alt='ã‚ãªãŸã®ãƒ©ã‚¤ãƒ•ã‚­ãƒ£ãƒªã‚¢ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼' />" +
              "</body></html>"
            );
            win.document.close();
          }
        }
      })
      .catch(function (err) {
        alert("ãƒ¬ã‚¤ãƒ³ãƒœãƒ¼å›³ã®ç”»åƒä½œæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚åˆ¥ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ãŠè©¦ã—ãã ã•ã„ã€‚");
        console.error(err);
        document.body.removeChild(captureContainer);
      });
  });
}

// é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³
if (rainbowCloseBtn) {
  rainbowCloseBtn.addEventListener("click", function () {
    rainbowOverlay.classList.add("hidden");
  });
}

// èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ã‚‚é–‰ã˜ã‚‹
if (rainbowOverlay) {
  rainbowOverlay.addEventListener("click", function (e) {
    if (e.target === rainbowOverlay) {
      rainbowOverlay.classList.add("hidden");
    }
  });
}

// ç”»é¢ãƒªã‚µã‚¤ã‚ºæ™‚ã«ã€ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ãŒé–‹ã„ã¦ã„ã‚Œã°å†æç”»
window.addEventListener("resize", function () {
  if (!rainbowOverlay.classList.contains("hidden")) {
    buildRainbowChart();
  }
});

// åˆæœŸè¡¨ç¤º
updateAges();
updateSums();
</script>
</body>
</html>
